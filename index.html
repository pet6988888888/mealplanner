<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>7-Day Meal Plan Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
        
        body {
            /* Dark Theme Base Colors */
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 (This is the source of the inheritance problem) */
        }

        /* Style for selected meal cells */
        .meal-slot.filled {
            background-color: #1e3a8a; /* Darker Blue 900 */
            border: 2px solid #6366f1; /* Indigo 500 */
            transition: all 0.2s;
        }

        /* Styling for tag buttons */
        .tag-button {
            transition: all 0.2s;
            cursor: pointer;
            background-color: #475569; /* Slate 600 default */
            color: #e2e8f0; /* Slate 200 */
        }

        .tag-button.active {
            background-color: #0d9488; /* Teal active color (remains vibrant) */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(13, 148, 136, 0.5);
            transform: scale(1.05);
        }

        /* Cover Preview Styles */
        #coverPreviewContainer {
            margin-top: 1rem;
            text-align: center;
        }
        #coverPreview {
            max-width: 100%;
            height: auto;
            aspect-ratio: 210 / 297; /* A4 ratio */
            border-radius: 0.75rem;
            border: 2px solid #475569;
            margin: 0 auto;
        }

        /* --- PRINT STYLES FOR BEAUTIFUL PDF GENERATION --- */
        @media print {
            /* Hide the main UI controls and grid to only show the generated document */
            #app, #recipeModal, #notificationArea {
                display: none !important;
            }
            
            /* Make the print output modal fill the page and remove shadows/borders */
            #printOutputModal {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                margin: 0 !important;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
                background-color: white !important;
                display: block !important;
            }
            
            /* Remove the modal dialog styling */
            #printOutputDialog {
                width: 100% !important;
                max-width: none !important;
                height: auto !important;
                max-height: none !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                overflow: visible !important;
                padding: 0 !important;
                transform: none !important;
                background: white !important;
            }

            /* Hide the modal's controls (now at the top) */
            #printOutputHeaderControls {
                display: none !important;
            }

            /* CRITICAL: Remove height restrictions and overflow on content container */
            #printOutputDialog > div {
                max-height: none !important;
                overflow: visible !important;
                padding: 0 !important;
            }

            /* Adjust content padding for printing and remove all height/overflow restrictions */
            #outputContentDiv {
                padding: 0.5in !important;
                max-height: none !important;
                overflow: visible !important;
                height: auto !important;
                border: none !important;
            }

            /* Force black text for print clarity */
            * {
                color: black !important;
                box-shadow: none !important;
                text-shadow: none !important;
                background: white !important;
            }
            
            /* Ensure page breaks work correctly for recipe cards */
            .recipe-card-print {
                page-break-inside: avoid;
                margin-bottom: 1rem;
            }

            /* Ensure image placeholders are small for print */
            .recipe-image {
                max-width: 100%;
                height: auto;
            }
        }
@media print {
    #printOutputDialog > div.p-6.bg-slate-700 {
        display: none !important;
    }
}
        /* --- END PRINT STYLES --- */


        /* Styling for the content div (when displayed in modal) - MUST be light for contrast/printing */
        #outputContentDiv {
            min-height: 400px;
            max-height: 60vh;
            overflow-y: scroll;
            background-color: #ffffff; /* White background for document */
            color: #1f2937; /* FIX: Explicitly set text color to dark gray to override body inheritance */
            border: 1px solid #d1d5db;
            /* Use a nicer font for the document content */
            font-family: 'Playfair Display', serif; 
        }
        /* Custom class for list style on instructions */
        .instruction-list > li {
            counter-increment: instruction-step;
            margin-bottom: 0.5rem;
        }
        .instruction-list > li::before {
            content: counter(instruction-step) ". ";
            font-weight: bold;
            color: #0d9488; /* Teal color for step number */
        }
        .instruction-list {
            list-style: none;
            counter-reset: instruction-step;
            padding-left: 0;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="mb-8 p-4 bg-slate-800 rounded-xl shadow-2xl border-t-4 border-teal-500">
            <h1 class="text-3xl font-extrabold text-teal-400 mb-2">Weekly Meal Planner</h1>
            <p class="text-slate-400">Plan your meals for 7 days, select recipes from available options, and generate a complete meal plan with shopping list and recipes.</p>
            
            <!-- NEW: Plan Status Tracker -->
            <div id="planStatus" class="mt-3 flex flex-wrap gap-4 text-sm font-semibold text-slate-300">
                <span id="filledSlots" class="px-3 py-1 bg-blue-700 text-blue-200 rounded-full shadow-md">Meals Planned: 0 / 28</span>
                <span id="uniqueRecipes" class="px-3 py-1 bg-teal-700 text-teal-200 rounded-full shadow-md">Unique Recipes Used: 0</span>
            </div>
            <!-- END NEW -->

        </header>

        <!-- Cover Upload Button and Preview -->
        <div id="coverUploadSection" class="mb-6 p-4 bg-slate-800 rounded-xl shadow-xl">
            <h2 class="text-2xl font-bold text-teal-400 mb-4">Upload Cover Image for Your Meal Plan</h2>
            <p class="text-slate-300 mb-4">Upload an A4 portrait image to be placed as the first page in your printed meal plan (recommended: 2480 x 3508 pixels)</p>
            
            <input type="file" id="coverUpload" accept="image/*" class="block w-full text-sm text-slate-400 mb-4
                file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0
                file:text-sm file:font-semibold file:bg-teal-600 file:text-white
                hover:file:bg-teal-700 file:cursor-pointer">
            
            <div id="coverPreviewContainer" class="hidden">
                <p class="text-sm text-slate-400 mb-2">Cover Preview:</p>
                <img id="coverPreview" alt="Cover preview" />
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="flex flex-col gap-4 mb-8">
            <!-- New Diet Filter and Autofill Block -->
            <div class="flex flex-col sm:flex-row gap-4">
                <select id="dietFilter" class="w-full sm:w-1/3 p-3 border border-slate-700 rounded-xl text-base bg-slate-700 text-slate-200 focus:ring-teal-500 focus:border-teal-500 shadow-md">
                    <!-- Options populated by JS -->
                </select>
                <button id="autoFillBtn" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-150 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500/50">
                    Auto-Fill Plan (Apply Filter)
                </button>
            </div>

            <!-- Clear and Generate Buttons -->
            <div class="flex flex-col sm:flex-row gap-4">
                <button id="clearPlanBtn" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-150 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-red-500/50">
                    Clear Plan
                </button>
                <button id="generatePrintBtn" class="flex-1 bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-150 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-teal-500/50">
                    Generate Meal Plan
                </button>
            </div>
        </div>

        <!-- Meal Plan Grid -->
        <div id="mealPlanGridContainer" class="bg-slate-800 p-2 sm:p-6 rounded-xl shadow-2xl overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-700">
                <thead class="bg-slate-700">
                    <tr>
                        <th class="px-2 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Day</th>
                        <th class="px-2 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Breakfast</th>
                        <th class="px-2 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Lunch</th>
                        <th class="px-2 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Dinner</th>
                        <th class="px-2 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Snack</th>
                    </tr>
                </thead>
                <tbody id="mealPlanBody" class="bg-slate-800 divide-y divide-slate-700">
                    <!-- Grid content will be rendered here by JavaScript -->
                </tbody>
            </table>
        </div>

    </div>

    <!-- Recipe Selection Modal -->
    <div id="recipeModal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center p-4 z-50 transition-opacity duration-300" onclick="if(event.target.id === 'recipeModal') closeModal()">
        <div class="bg-slate-800 w-full max-w-lg max-h-[90vh] rounded-xl shadow-2xl overflow-hidden transform scale-100 transition-transform duration-300">
            <div class="p-6 overflow-y-auto">
                <h2 class="text-2xl font-bold text-teal-400 mb-4">Select Recipe for <span id="modalTitleSlot" class="text-indigo-400"></span></h2>
                
                <!-- Filters: Category Dropdown & Tag Buttons -->
                <div class="mb-4 space-y-3 p-3 bg-slate-700 rounded-lg">
                    <!-- Category Filter -->
                    <select id="categoryFilter" class="w-full p-3 border border-slate-600 rounded-lg text-base bg-slate-600 text-slate-200 focus:ring-teal-500 focus:border-teal-500" onchange="filterRecipes()">
                        <option value="">All Categories</option>
                        <!-- Options filled by JS -->
                    </select>
                    
                    <p class="text-sm font-semibold text-slate-300 mt-3">Filter by Tags (Select multiple):</p>
                    <!-- Tag Buttons Container -->
                    <div id="tagButtonContainer" class="flex flex-wrap gap-2 pt-1">
                        <!-- Curated Tag buttons filled by JS -->
                    </div>
                </div>

                <!-- Recipe List -->
                <div id="recipeList" class="space-y-3 max-h-80 overflow-y-auto pr-2">
                    <!-- Recipes will be loaded here -->
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="p-4 bg-slate-700 flex justify-end">
                <button onclick="closeModal()" class="bg-slate-600 hover:bg-slate-500 text-slate-200 font-bold py-2 px-4 rounded-lg transition duration-150">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Printable HTML Output Modal -->
    <div id="printOutputModal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center p-4 z-50 transition-opacity duration-300" onclick="if(event.target.id === 'printOutputModal') closePrintOutputModal()">
        <div id="printOutputDialog" class="bg-slate-800 w-full max-w-4xl max-h-[90vh] rounded-xl shadow-2xl overflow-hidden transform scale-100 transition-transform duration-300">
            
            <div class="p-6 bg-slate-700">
                <h2 class="text-2xl font-bold text-teal-400 mb-4">Review Document for Printing</h2>
                
                <!-- START: Moved Controls (New Header Section) -->
                <div id="printOutputHeaderControls" class="flex flex-wrap justify-end gap-3 mb-4">
                    <button onclick="triggerPrintWithDelay()" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-lg">
                        Print Document
                    </button>
                    <button onclick="closePrintOutputModal()" class="bg-slate-600 hover:bg-slate-500 text-slate-200 font-bold py-2 px-4 rounded-lg transition duration-150 shadow-lg">
                        Close
                    </button>
                </div>
                <!-- END: Moved Controls -->

                <!-- Content Div for Styled HTML - Moved outside the control section but inside the dialog -->
                <!-- Removed the top padding here since the header has it -->
            </div> 

            <div class="p-6 pt-0 max-h-[70vh] overflow-y-auto print:!max-h-none print:!overflow-visible print:!p-0">
                <div id="outputContentDiv" class="w-full p-6 rounded-lg text-sm border-2 border-slate-700 print:!border-0 print:!rounded-none">
                    <!-- Styled content will be generated here -->
                </div>
            </div>

            
            <!-- Modal Footer (REMOVED - functionality moved to printOutputHeaderControls) -->
        </div>
    </div>

    <!-- Notification Area (for errors/warnings) -->
    <div id="notificationArea" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
        <!-- Content generated dynamically -->
    </div>

    <script>
        // Use an empty string for the API key as it will be provided by the environment
        const apiKey = ""; 

        // --- CURATED TAGS LIST ---
        // This list defines the buttons shown to the user. Recipes must have these exact strings in their tags array.
        const CURATED_TAGS = [
            'Gluten Free',
            'Dairy Free',
            'Low Carb',
            'Meal Prep/Freezer Friendly',
            'High Protein',
            'Vegetarian',
            'Quick',
            'Contains Nuts'
        ];

        // --- MAJOR DIET FILTER MAPPING ---
        // Map display names to the exact tag needed for filtering
        const MAJOR_DIETS = {
            '': 'All Diets',
            'Low Carb': 'Low Carb',
            'Vegetarian': 'Vegetarian',
            'High Protein': 'High Protein',
            'Gluten Free': 'Gluten Free',
            'Dairy Free': 'Dairy Free',
        };

        // --- Ingredient Categorization Mapping (New Logic) ---
        // Maps ingredients to the fixed shopping list categories for printing.
        const FINAL_CATEGORIES = {
            'Fruits': ['apple', 'peach', 'blueberry', 'banana', 'kiwi', 'lime', 'lemon', 'berries', 'mango', 'applesauce'],
            'Vegetables': ['kale', 'sweetcorn', 'onion', 'broccoli', 'spinach', 'carrot', 'tomato', 'avocado', 'eggplant', 'pepper', 'chive', 'cilantro', 'ginger', 'vegetables', 'peas', 'beetroot'],
            'Protein': ['chicken', 'beef', 'turkey', 'tuna', 'prawn', 'egg', 'greek yogurt', 'protein powder', 'chorizo'],
            'Dairy': ['milk', 'cheese', 'ricotta', 'cream cheese', 'cottage cheese', 'butter'],
            'Seeds & Nuts': ['oats', 'chia seeds', 'linseeds', 'pecans', 'almond', 'cashew', 'peanut butter', 'almond butter', 'hemp seeds', 'nuts', 'tahini'],
            'Baking & Grains': ['flour', 'polenta', 'quinoa', 'pasta', 'tortilla', 'pancake mix', 'breadcrumbs', 'baking powder', 'baking soda', 'rice'],
            'Cans & Jarred': ['chickpea', 'coconut milk', 'vegetable broth', 'canned tuna', 'jam', 'chocolate'],
            'Spices': ['cinnamon', 'spices', 'curry powder', 'paprika', 'vanilla extract', 'matcha powder'],
            'Condiments': ['honey', 'bbq sauce', 'soy sauce', 'teriyaki sauce', 'vinaigrette', 'mayo', 'taco seasoning', 'salsa', 'sugar'],
            'Misc': [] // Everything else falls into Misc
        };
        const SHOPPING_CATEGORIES_ORDER = Object.keys(FINAL_CATEGORIES); // Use the order of the keys defined above


        // --- Mock Data Setup (now 27 recipes total) ---
        // Tags are standardized to the CURATED_TAGS list where possible.
        const RECIPES = [
            { 
                id: 'r1', name: 'Chocolate Baked Oats', category: 'Breakfast', 
                ingredients: [{ name: 'Rolled Oats', quantity: '1 cup' }, { name: 'Cocoa Powder', quantity: '2 tbsp' }, { name: 'Milk', quantity: '1/2 cup' }, { name: 'Sweetener', quantity: 'to taste' }], 
                instructions: '1. Preheat oven to 180°C. 2. Combine all ingredients in a bowl and mix well. 3. Pour into an oven-safe dish. 4. Bake for 20-25 minutes until set. Serve warm.', 
                tags: ['Quick', 'High Protein', 'Vegetarian'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/cbo.jpg',
                nutrition: { Prep: '5 mins', Cook: '20 mins', Kcal: 350, Fats: 10, Carbs: 55, Protein: 12, Fibre: 8 },
                storage: 'Store in an airtight container for up to 3 days.'
            },
            { 
                id: 'r2', name: 'Peach, Honey & Cinnamon Overnight Oats', category: 'Breakfast', 
                ingredients: [{ name: 'Rolled Oats', quantity: '1 cup' }, { name: 'Milk', quantity: '1/2 cup' }, { name: 'Peaches, sliced', quantity: '1' }, { name: 'Honey', quantity: '1 tsp' }, { name: 'Cinnamon', quantity: '1/2 tsp' }], 
                instructions: '1. Combine oats, milk, honey, and cinnamon in a jar. 2. Layer with sliced peaches. 3. Refrigerate overnight. Serve cold.', 
                tags: ['Quick', 'Meal Prep/Freezer Friendly', 'Vegetarian'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_37.jpg',
                nutrition: { Prep: '10 mins', Cook: '0 mins', Kcal: 290, Fats: 5, Carbs: 48, Protein: 10, Fibre: 6 },
                storage: 'Store in the refrigerator for up to 2 days.'
            },
            { 
                id: 'r3', name: 'Cheeseburger Omelet', category: 'Breakfast', 
                ingredients: [{ name: 'Eggs', quantity: '3' }, { name: 'Ground Beef', quantity: '100g' }, { name: 'Cheese, shredded', quantity: '30g' }, { name: 'Onion, diced', quantity: '1/4' }], 
                instructions: '1. Cook ground beef and onions. Drain fat. 2. Whisk eggs. Pour into a non-stick pan. 3. When edges set, add beef and cheese to one side. 4. Fold the omelet and cook until cheese melts.', 
                tags: ['High Protein', 'Low Carb', 'Quick', 'Gluten Free'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_38.jpg',
                nutrition: { Prep: '5 mins', Cook: '10 mins', Kcal: 450, Fats: 30, Carbs: 5, Protein: 40, Fibre: 1 },
                storage: 'Best consumed immediately.'
            },
            { 
                id: 'r4', name: 'Mexican Sweetcorn Frittata With Beef Bites', category: 'Breakfast', 
                ingredients: [{ name: 'Eggs', quantity: '4' }, { name: 'Sweetcorn, canned', quantity: '1/2 cup' }, { name: 'Ground Beef (cooked)', quantity: '100g' }, { name: 'Feta Cheese', quantity: '20g' }, { name: 'Spices', quantity: '1 tsp' }], 
                instructions: '1. Mix all ingredients except feta. 2. Pour into a small oven-safe pan. 3. Sprinkle with feta. 4. Bake at 180°C for 15-20 minutes until set.', 
                tags: ['High Protein', 'Quick', 'Gluten Free'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_43.jpg',
                nutrition: { Prep: '10 mins', Cook: '20 mins', Kcal: 400, Fats: 25, Carbs: 20, Protein: 35, Fibre: 3 },
                storage: 'Store in the refrigerator for up to 3 days.'
            }, 
            { 
                id: 'r5', name: 'Spicy Chicken & Chickpeas', category: 'Lunch', 
                ingredients: [{ name: 'Chicken Breast', quantity: '150g' }, { name: 'Chickpeas, canned', quantity: '1/2 cup' }, { name: 'Spices (Chili/Cumin)', quantity: '1 tbsp' }, { name: 'Olive Oil', quantity: '1 tsp' }], 
                tags: ['Meal Prep/Freezer Friendly', 'Gluten Free', 'High Protein', 'Dairy Free'], 
                instructions: '1. Dice chicken and toss with spices. 2. Cook chicken in a pan until done. 3. Add chickpeas and cook until heated through. Serve with rice or salad.', 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_44.jpg',
                nutrition: { Prep: '5 mins', Cook: '15 mins', Kcal: 380, Fats: 10, Carbs: 35, Protein: 38, Fibre: 7 },
                storage: 'Store in the refrigerator for up to 4 days.'
            },
            { 
                id: 'r6', name: 'Kale, Quinoa & Blueberry Salad', category: 'Lunch', 
                ingredients: [{ name: 'Kale', quantity: '1 bunch' }, { name: 'Quinoa, cooked', quantity: '1/2 cup' }, { name: 'Blueberries', quantity: '1/2 cup' }, { name: 'Vinaigrette Dressing', quantity: '2 tbsp' }, { name: 'Toasted Pecans', quantity: '1/4 cup' }], 
                instructions: '1. Massage kale with a little dressing to soften. 2. Combine kale, quinoa, blueberries, and pecans. 3. Toss with remaining dressing just before serving.', 
                tags: ['Vegetarian', 'Quick', 'Gluten Free', 'Dairy Free', 'Contains Nuts'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_45.jpg',
                nutrition: { Prep: '10 mins', Cook: '0 mins', Kcal: 320, Fats: 15, Carbs: 35, Protein: 8, Fibre: 6 },
                storage: 'Store dry ingredients separate from dressing; lasts 3 days.'
            },
            { 
                id: 'r7', name: 'High Protein Polenta Base BBQ Pizza', category: 'Dinner', 
                ingredients: [{ name: 'Polenta', quantity: '1 cup' }, { name: 'BBQ Sauce', quantity: '2 tbsp' }, { name: 'Shredded Chicken', quantity: '50g' }, { name: 'Mozzarella', quantity: '1/2 cup' }, { name: 'Red Onion', quantity: '1/4' }], 
                instructions: '1. Prepare polenta and spread onto a baking sheet to cool. 2. Top with BBQ sauce, chicken, mozzarella, and onion. 3. Bake at 200°C until cheese is bubbly and crust is firm.', 
                tags: ['High Protein'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_46.jpg',
                nutrition: { Prep: '15 mins', Cook: '15 mins', Kcal: 480, Fats: 18, Carbs: 50, Protein: 30, Fibre: 5 },
                storage: 'Refrigerate leftovers for up to 2 days.'
            },
            { 
                id: 'r8', name: 'Thai Fish Parcels', category: 'Dinner', 
                ingredients: [{ name: 'White Fish Fillets', quantity: '2' }, { name: 'Coconut Milk', quantity: '1/4 cup' }, { name: 'Ginger, grated', quantity: '1 tsp' }, { name: 'Lime', quantity: '1/2' }, { name: 'Cilantro', quantity: '1 tbsp' }], 
                instructions: '1. Place fish on foil. Top with coconut milk, ginger, lime slices, and cilantro. 2. Seal the foil into a parcel. 3. Bake at 180°C or steam for 15 minutes until fish is cooked.', 
                tags: ['Low Carb', 'Quick', 'Gluten Free', 'Dairy Free'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_48.jpg',
                nutrition: { Prep: '5 mins', Cook: '15 mins', Kcal: 310, Fats: 18, Carbs: 5, Protein: 35, Fibre: 1 },
                storage: 'Best consumed immediately.'
            },
            { 
                id: 'r9', name: 'Teriyaki Turkey Stir-Fry', category: 'Dinner', 
                ingredients: [{ name: 'Turkey Mince', quantity: '200g' }, { name: 'Broccoli florets', quantity: '1 cup' }, { name: 'Soy Sauce', quantity: '2 tbsp' }, { name: 'Cooked Rice', quantity: '1 cup' }, { name: 'Teriyaki Sauce', quantity: '3 tbsp' }], 
                instructions: '1. Brown turkey mince in a wok. 2. Add broccoli and stir-fry until tender-crisp. 3. Stir in teriyaki and soy sauce. 4. Serve over cooked rice.', 
                tags: ['Quick', 'High Protein', 'Dairy Free'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_49.jpg',
                nutrition: { Prep: '10 mins', Cook: '10 mins', Kcal: 420, Fats: 10, Carbs: 45, Protein: 40, Fibre: 5 },
                storage: 'Store in airtight containers for up to 3 days.'
            },
            { 
                id: 'r10', name: 'High Protein Tuna Bake', category: 'Dinner', 
                ingredients: [{ name: 'Canned Tuna (in water)', quantity: '180g' }, { name: 'Cottage Cheese', quantity: '1/2 cup' }, { name: 'Wholemeal Pasta (cooked)', quantity: '1 cup' }, { name: 'Frozen Peas', quantity: '1/4 cup' }, { name: 'Breadcrumbs', quantity: '1 tbsp' }], 
                instructions: '1. Mix tuna, cottage cheese, cooked pasta, and peas. 2. Place in an oven-safe dish. 3. Top with breadcrumbs. 4. Bake at 180°C for 15 minutes until golden brown.', 
                tags: ['High Protein', 'Meal Prep/Freezer Friendly'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_50.jpg',
                nutrition: { Prep: '10 mins', Cook: '15 mins', Kcal: 450, Fats: 8, Carbs: 50, Protein: 45, Fibre: 6 },
                storage: 'Perfect for batch cooking; refrigerate up to 4 days.'
            },
            { 
                id: 'r11', name: 'Keto Eggplant Lasagna', category: 'Dinner', 
                ingredients: [{ name: 'Eggplant (thinly sliced)', quantity: '1 large' }, { name: 'Ground Beef', quantity: '250g' }, { name: 'Mozzarella Cheese (shredded)', quantity: '1 cup' }, { name: 'Tomato Sauce (low sugar)', quantity: '1/2 cup' }, { name: 'Ricotta Cheese', quantity: '1/2 cup' }], 
                instructions: '1. Brown ground beef and mix with tomato sauce. 2. Layer eggplant, meat sauce, ricotta, and mozzarella in a baking dish. 3. Repeat layers. 4. Bake at 190°C for 30-40 minutes.', 
                tags: ['Low Carb', 'Meal Prep/Freezer Friendly', 'Gluten Free', 'High Protein'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_51.jpg',
                nutrition: { Prep: '20 mins', Cook: '40 mins', Kcal: 550, Fats: 35, Carbs: 20, Protein: 40, Fibre: 10 },
                storage: 'Refrigerate for up to 4 days.'
            }, 
            { 
                id: 'r12', name: '5-Minute Tomato Salsa', category: 'Snack', 
                ingredients: [{ name: 'Tomatoes, diced', quantity: '2 large' }, { name: 'Red Onion, diced', quantity: '1/4' }, { name: 'Cilantro, chopped', quantity: '1/4 cup' }, { name: 'Lime Juice', quantity: '1 tbsp' }], 
                instructions: '1. Combine all ingredients in a bowl. 2. Season with salt and pepper to taste. Serve immediately.', 
                tags: ['Quick', 'Vegetarian', 'Gluten Free', 'Dairy Free'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_47.jpg',
                nutrition: { Prep: '5 mins', Cook: '0 mins', Kcal: 50, Fats: 0, Carbs: 10, Protein: 2, Fibre: 2 },
                storage: 'Store in the refrigerator for up to 3 days.'
            }, 
            { 
                id: 'r13', name: 'Vanilla & Cinnamon Protein Balls', category: 'Snack', 
                ingredients: [{ name: 'Rolled Oats', quantity: '¾ cup (60g)' }, { name: 'Almond Butter, smooth', quantity: '½ cup (125g)' }, { name: 'Almonds', quantity: '½ cup (75g)' }, { name: 'Honey', quantity: '4 tbsp.' }, { name: 'Vanilla Whey Protein Powder', quantity: '1 scoop (25g)' }, { name: 'Ground Cinnamon', quantity: '1 tsp' }, { name: 'Vanilla Extract', quantity: '1 tsp' }, { name: 'Water', quantity: '2 tbsp' }], 
                instructions: '1. Place the oats, almond butter, almonds, honey, protein powder, cinnamon and vanilla extract into a food processor and process until a dough like consistency forms. Add the 2 tablespoons of water and continue to blitz the mixture until the balls start to stick together. 2. Roll the mixture into 16 balls (about 1 tablespoon per ball). 3. Mix 2 tablespoons of vanilla protein powder and 1 teaspoon ground cinnamon in a large zip-lock bag. Place the protein balls inside the bag and gently toss in the mixture until the balls are coated.', 
                tags: ['High Protein', 'Contains Nuts', 'Meal Prep/Freezer Friendly', 'Vegetarian'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_54.jpg',
                nutrition: { Prep: '10 mins', Cook: '0 mins', Kcal: 134, Fats: 8, Carbs: 12, Protein: 5, Fibre: 3 },
                storage: 'Store in the refrigerator for up to 5 days.'
            },
            { 
                id: 'r14', name: 'Carrot Cake Muffins With Cashew Icing', category: 'Snack', 
                ingredients: [{ name: 'Carrots, grated', quantity: '1 cup' }, { name: 'Flour', quantity: '1 cup' }, { name: 'Eggs', quantity: '2' }, { name: 'Cashews', quantity: '1/4 cup' }, { name: 'Cream Cheese', quantity: '2 tbsp' }, { name: 'Baking Powder', quantity: '1 tsp' }], 
                instructions: '1. Combine wet and dry ingredients for muffins. Stir in grated carrots. 2. Fill muffin cups and bake at 180°C for 20 minutes. 3. Blend cashews and cream cheese for icing. Top muffins when cool.', 
                tags: ['Contains Nuts', 'Vegetarian'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_52.jpg',
                nutrition: { Prep: '15 mins', Cook: '20 mins', Kcal: 250, Fats: 15, Carbs: 25, Protein: 6, Fibre: 3 },
                storage: 'Store in an airtight container for up to 3 days.'
            },
            { 
                id: 'r15', name: 'Blackberry & Vanilla Linseed Pudding', category: 'Snack', 
                ingredients: [{ name: 'Linseeds (Flaxseeds)', quantity: '2 tbsp' }, { name: 'Blackberries, frozen', quantity: '1 cup' }, { name: 'Vanilla Extract', quantity: '1 tsp' }, { name: 'Milk', quantity: '1/2 cup' }, { name: 'Sweetener', quantity: 'to taste' }], 
                instructions: '1. Blend blackberries, milk, and vanilla extract until smooth. 2. Stir in linseeds and sweetener. 3. Pour into a glass and refrigerate overnight until thickened. 4. Serve with fresh berries.', 
                tags: ['Quick', 'Gluten Free', 'Vegetarian', 'Dairy Free'], 
                image: 'https://homeworkoutfactory.com/wp-content/uploads/2025/10/Screenshot_53.jpg',
                nutrition: { Prep: '5 mins', Cook: '0 mins', Kcal: 200, Fats: 10, Carbs: 25, Protein: 5, Fibre: 8 },
                storage: 'Store in the refrigerator for up to 2 days.'
            },
            { 
                id: 'r16', name: 'Rocket & Soft Scrambled Eggs Breakfast Salad', category: 'Breakfast', 
                ingredients: [{ name: 'rocket', quantity: '2 cups (60g)' }, { name: 'olive oil', quantity: '2 tsp.' }, { name: 'lemon juice', quantity: '2 tbsp.' }, { name: 'feta cheese', quantity: '¼ cup (40g), crumbled' }, { name: 'avocado', quantity: '½, cubed' }, { name: 'eggs', quantity: '4' }, { name: 'salt & pepper', quantity: 'to taste' }, { name: 'butter', quantity: '1 tbsp.' }, { name: 'cayenne pepper', quantity: 'to taste' }], 
                instructions: '1. Place the rocket in a bowl with the olive oil and lemon juice and toss to combine. Mix in the feta and avocado and divide between two bowls. 2. Heat the butter in a non-stick skillet over a medium heat. Whisk the eggs in a small bowl and season with salt and pepper. Once the butter has melted add the eggs to the pan and cook until a thin layer of cooked egg appears around the edge of the skillet. Using a rubber spatula, push the eggs around the skillet until they are fluffy and just set, this takes around 2 minutes. Take the eggs off the heat to stop them overcooking. 3. Divide the eggs between the two salad bowls and sprinkle over a pinch of cayenne pepper.', 
                tags: ['GF', 'LC', 'V', 'Q'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_124.jpg',
                nutrition: { Prep: '10 mins', Cook: '5 mins', Kcal: 237, Fats: 22, Carbs: 8, Protein: 5, Fibre: 4 },
                storage: ''
            },
            { 
                id: 'r17', name: 'High Protein Breakfast Pizza', category: 'Breakfast', 
                ingredients: [{ name: 'coconut oil', quantity: '½ tsp.' }, { name: 'egg', quantity: '1' }, { name: 'egg whites', quantity: '5' }, { name: 'coconut flour', quantity: '1 tbsp.' }, { name: 'zucchini (courgette), grated', quantity: '¼ cup (30g)' }, { name: 'herbs de provence (mixed herbs)', quantity: 'to taste' }, { name: 'salt & pepper', quantity: 'to taste' }, { name: 'tomato sauce (passata)', quantity: '⅓ cup (80ml)' }, { name: 'Parmesan cheese, grated', quantity: '2 tsp.' }], 
                instructions: '1. Heat the oil in a 9-inch non-stick skillet over a medium heat. 2. In a bowl, whisk together the egg, egg whites, grated zucchini, coconut flour, herbs and season to taste with salt and pepper. Pour the egg mixture into the skillet, cover with a lid and cook gently until the eggs are set. 3. Serve immediately, topped with the tomato sauce and Parmesan cheese.', 
                tags: ['GF', 'LC', 'MP', 'HP', 'V', 'Q'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_1.jpg',
                nutrition: { Prep: '10 mins', Cook: '5 mins', Kcal: 262, Fats: 10, Carbs: 13, Protein: 29, Fibre: 5 },
                storage: ''
            },
            { 
                id: 'r18', name: 'Cinnamon Granola', category: 'Treat', 
                ingredients: [{ name: 'coconut oil, melted', quantity: '½ cup (120ml)' }, { name: 'honey', quantity: '3 tbsp.' }, { name: 'apple sauce, unsweetened', quantity: '3 tbsp.' }, { name: 'rolled oats', quantity: '1 ½ cup (225g)' }, { name: 'almonds, chopped', quantity: '¼ cup (30g)' }, { name: 'Brazil nuts, chopped', quantity: '5' }, { name: 'sunflower seeds', quantity: '¼ cup (35g)' }, { name: 'chia seeds', quantity: '2 tbsp.' }, { name: 'ground cinnamon', quantity: '1 tbsp.' }, { name: 'salt', quantity: '¼ tsp.' }], 
                instructions: '1. Preheat the oven to 350°F (180°C). Line a baking sheet with baking paper. 2. Combine all the wet ingredients together in a large bowl. Now add the dry ingredients and mix well with a spatula until all the ingredients are well combined. 3. Pour the granola mixture onto the baking sheet, place the tray in the oven and bake for 25-30 minutes until golden brown. Remove the tray from the oven half way through and give the granola a stir, before returning the tray to the oven. 4. Remove the baking sheet from the oven and set it aside to cool completely, before breaking up the granola and placing it in an airtight storage container. Keep in a cool place for up to 2 weeks.', 
                tags: ['DF', 'MP', 'V', 'N'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_2.jpg',
                nutrition: { Prep: '5 mins', Cook: '30 mins', Kcal: 226, Fats: 15, Carbs: 20, Protein: 4, Fibre: 4 },
                storage: 'Keep in a cool place for up to 2 weeks.'
            },
            { 
                id: 'r19', name: 'Grapefruit Breakfast Pots', category: 'Breakfast', 
                ingredients: [{ name: 'grapefruit', quantity: '1, peeled and segmented, retain juice' }, { name: 'quark', quantity: '2 cups (490g)' }, { name: 'Greek yogurt', quantity: '1 cup (240g)' }, { name: 'honey', quantity: '4 tbsp.' }, { name: 'cinnamon granola', quantity: '2 servings' }], 
                instructions: '1. When segmenting the grapefruit, preserve 2 tablespoons of the grapefruit juice. 2. Mix the quark, Greek yogurt, grapefruit juice and 2 tablespoons of honey together in a bowl. 3. Divide the granola between 4 glasses and spoon over the yogurt mix. To serve, top with the grapefruit segments and drizzle over the remaining honey.', 
                tags: ['HP', 'V', 'Q', 'N'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_3.jpg',
                nutrition: { Prep: '15 mins', Cook: '0 mins', Kcal: 319, Fats: 9, Carbs: 40, Protein: 22, Fibre: 1 },
                storage: ''
            },
            { 
                id: 'r20', name: 'Zucchini, Potato & Feta Soup', category: 'Lunch', 
                ingredients: [{ name: 'olive oil', quantity: '1 tbsp.' }, { name: 'butter', quantity: '1 tbsp.' }, { name: 'yellow onion, diced', quantity: '1' }, { name: 'potatoes, peeled, cubed', quantity: '4 medium' }, { name: 'garlic clove, minced', quantity: '1' }, { name: 'vegetable broth (stock)', quantity: '6 ½ cups (1.5L)' }, { name: 'ground turmeric', quantity: '⅓ tsp.' }, { name: 'salt & pepper', quantity: 'to taste' }, { name: 'zucchinis (courgettes)', quantity: '2 medium' }, { name: 'fresh dill, chopped', quantity: '2 tbsp.' }, { name: 'single cream', quantity: '⅓ cup (80ml)' }, { name: 'feta cheese, cubed', quantity: '7 oz. (200g)' }], 
                instructions: '1. Heat the oil and butter together in a pot over a medium heat. Add the onion and cook until softened, stirring often, for around 5 minutes. 2. Add the potatoes to the pot and cook for a further 2-3 minutes, stirring constantly. Next add garlic and pour in the vegetable broth. Bring to the boil and add the turmeric and season to taste with salt and pepper. 3. Finally, add the zucchini, bring to a boil and then lower the heat and simmer gently for 10 minutes. Once the potatoes have softened take the pot off the heat. 4. Now stir through the dill and cream, spoon into bowls and serve with the feta cheese.', 
                tags: ['GF', 'MP', 'V'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_4.jpg',
                nutrition: { Prep: '15 mins', Cook: '20 mins', Kcal: 286, Fats: 14, Carbs: 33, Protein: 9, Fibre: 4 },
                storage: ''
            },
            { 
                id: 'r21', name: 'Nutritious Grapefruit & Couscous Salad', category: 'Lunch', 
                ingredients: [{ name: 'vegetable broth (stock)', quantity: '¾ cup (180ml)' }, { name: 'couscous, uncooked', quantity: '¾ cup (130g)' }, { name: 'avocado, cubed', quantity: '1' }, { name: 'grapefruits, segmented', quantity: '2' }, { name: 'cannellini beans', quantity: '14 oz. (400g) can, drained & rinsed' }, { name: 'feta cheese, crumbled', quantity: '½ cup (75g)' }, { name: 'fresh mint, chopped', quantity: '3 tbsp.' }, { name: 'fresh cilantro, chopped', quantity: '3 tbsp.' }, { name: 'lemon juice', quantity: '3 tbsp.' }, { name: 'grapefruit juice', quantity: '2 tbsp.' }, { name: 'honey', quantity: '1 tbsp.' }, { name: 'olive oil', quantity: '2 tbsp.' }, { name: 'salt', quantity: '¼ tsp.' }, { name: 'ground black pepper', quantity: 'to taste' }], 
                instructions: '1. Pour the vegetable broth into a small pot and bring to the boil over a medium high heat. Add the couscous, stir through and remove the pot from the heat. Cover the pot with a lid and set aside for 5 minutes. After 5 minutes, fluff the couscous with a fork and set aside. 2. Make the dressing by placing all the dressing ingredients together in a bowl and whisking until well combined. 3. Place the beans, couscous, avocados, grapefruit, feta, mint, and cilantro into a large bowl. Pour over the salad dressing and toss gently.', 
                tags: ['MP', 'V', 'Q'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_5.jpg',
                nutrition: { Prep: '15 mins', Cook: '5 mins', Kcal: 441, Fats: 20, Carbs: 59, Protein: 12, Fibre: 11 },
                storage: ''
            },
            { 
                id: 'r22', name: 'Zucchini & Millet Burgers', category: 'Lunch', 
                ingredients: [{ name: 'zucchini (courgette), grated', quantity: '1 medium' }, { name: 'millet', quantity: '⅓ cup (70g)' }, { name: 'carrot, grated', quantity: '1' }, { name: 'vegetable broth (stock)', quantity: '1 cup (250ml)' }, { name: 'small onion, grated', quantity: '1' }, { name: 'garlic, minced', quantity: '1 clove' }, { name: 'eggs', quantity: '2' }, { name: 'breadcrumbs', quantity: '8 tbsp.' }, { name: 'parsley, chopped', quantity: '1 tbsp.' }, { name: 'dill, chopped', quantity: '1 tbsp.' }, { name: 'olive oil', quantity: '2 tbsp.' }, { name: 'salt & pepper', quantity: 'to taste' }], 
                instructions: '1. Cut the zucchini into quarters, lengthwise, remove the core and discard the seeds. Now grate the zucchini into a large bowl and set aside. 2. Place a small pot over a medium-high heat. Add the millet and grated carrot, pour in the broth, cover and bring to a boil. Reduce heat and simmer 15 minutes until liquid is absorbed. Set aside to cool. 3. Drain any juices from the zucchini, grate in the onion and add garlic. Add 3 tbsp breadcrumb and mix. Add cooled millet/carrot, parsley and dill. 4. Beat eggs with salt and pepper. Place remaining breadcrumbs on a plate. 5. Form 6 burgers. Dip in egg then breadcrumbs. 6. Fry burgers in olive oil 5 minutes each side until golden brown.', 
                tags: ['DF', 'MP', 'V'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_6.jpg',
                nutrition: { Prep: '15 mins', Cook: '35 mins', Kcal: 327, Fats: 15, Carbs: 39, Protein: 11, Fibre: 5 },
                storage: ''
            },
            { 
                id: 'r23', name: 'Simple Shredded Chicken 2 Ways', category: 'Lunch', 
                ingredients: [{ name: 'chicken breasts', quantity: '4 (500g/1.1 lb)' }, { name: 'chicken stock', quantity: '1 cup (250ml)' }, { name: 'salt', quantity: '½ tsp' }, { name: 'ground pepper', quantity: '¼ tsp.' }, { name: 'olive oil', quantity: '2 tbsp.' }], 
                instructions: 'Slow Cooked: 1. Season the chicken breasts with salt and pepper and place in the slow cooker. Pour over the stock, place the lid on and cook on low for 3-4 hours. 2. Once cooked, remove the chicken breasts and shred using two forks. Oven Baked: 1. Preheat the oven to 350°F (180°C). Line a baking sheet with baking paper. 2. Place chicken on the sheet, drizzle with olive oil, season and bake 25-35 minutes. 3. Rest 10-15 minutes then shred.', 
                tags: ['GF', 'DF', 'LC', 'MP', 'HP'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_7.jpg',
                nutrition: { Prep: '5 mins', Cook: '35 mins', Kcal: 211, Fats: 10, Carbs: 0, Protein: 28, Fibre: 0 },
                storage: 'Store in an airtight container in the refrigerator for up to 5 days.'
            },
            { 
                id: 'r24', name: 'Indonesian Chicken Salad', category: 'Lunch', 
                ingredients: [{ name: 'simple shredded chicken', quantity: '4 servings' }, { name: 'green onions, sliced', quantity: '1 bunch' }, { name: 'fresh mint, chopped', quantity: '4 tbsp.' }, { name: 'fresh cilantro, chopped', quantity: '4 tbsp.' }, { name: 'red bell pepper, sliced', quantity: '1' }, { name: 'mung bean sprouts', quantity: '2 cups (70g)' }, { name: 'roasted peanuts, chopped', quantity: '4 tbsp.' }, { name: 'lime juice', quantity: '4 tbsp.' }, { name: 'root ginger, grated', quantity: '2 tsp.' }, { name: 'garlic, minced', quantity: '1 clove' }, { name: 'fish sauce', quantity: '1 tbsp.' }, { name: 'crunchy peanut butter', quantity: '2 tbsp.' }, { name: 'Greek yogurt', quantity: '4 tbsp.' }, { name: 'red chilis, chopped', quantity: '2' }], 
                instructions: '1. Place all salad ingredients except peanuts into a large bowl and toss. 2. Mix dressing ingredients in a small bowl. 3. Pour dressing over salad, stir well, and scatter peanuts on top.', 
                tags: ['GF', 'LC', 'MP', 'HP', 'Q', 'N'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_8.jpg',
                nutrition: { Prep: '15 mins', Cook: '0 mins', Kcal: 309, Fats: 13, Carbs: 13, Protein: 37, Fibre: 5 },
                storage: ''
            },
            { 
                id: 'r25', name: 'Korean Style Salmon', category: 'Dinner', 
                ingredients: [{ name: 'salmon fillets, skin removed', quantity: '1.5 lbs. (700g)' }, { name: 'tamari', quantity: '2 tbsp.' }, { name: 'lemon juice', quantity: '2 tbsp.' }, { name: 'olive oil', quantity: '2 tsp.' }, { name: 'honey', quantity: '2 tsp.' }, { name: 'sweet chili sauce', quantity: '6 tbsp.' }, { name: 'soy sauce', quantity: '4 tbsp.' }, { name: 'tomato ketchup', quantity: '2 tbsp.' }, { name: 'sesame oil', quantity: '2 tsp.' }, { name: 'water', quantity: '6-12 tbsp.' }, { name: 'rice', quantity: '3 cups (480g)' }, { name: 'olive oil', quantity: '2 tbsp.' }, { name: 'eggplants', quantity: '2' }, { name: 'green onions', quantity: '4, sliced' }, { name: 'garlic, minced', quantity: '2 cloves' }, { name: 'sesame seeds', quantity: '2 tbsp.' }, { name: 'chili, chopped (optional)', quantity: '1' }], 
                instructions: 'For the salmon: 1. Place the salmon into an ovenproof dish and drizzle with tamari, lemon juice, olive oil and honey. Marinate 30-60 minutes. 2. Bake at 480°F (250°C) for 15 minutes. 3. Cook rice. For the eggplant: 1. Slice the eggplant. 2. Sauté white part of onions 2-3 minutes, add eggplant and stir fry 10 minutes. 3. Add garlic, some green onion, and all sauce ingredients. Bring to boil. To serve: Place salmon on plates, brush with the sauce, sprinkle sesame seeds, serve with rice and eggplant.', 
                tags: ['GF', 'DF', 'MP', 'HP'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_9.jpg',
                nutrition: { Prep: '15 mins', Cook: '30 mins', Kcal: 571, Fats: 19, Carbs: 59, Protein: 43, Fibre: 9 },
                storage: ''
            },
            { 
                id: 'r26', name: 'Low Carb Baked Turkey Meatballs', category: 'Dinner', 
                ingredients: [{ name: 'ground turkey breast', quantity: '2 lbs. (900g)' }, { name: 'mozzarella cheese, grated', quantity: '2 cups (230g)' }, { name: 'Parmesan cheese, grated', quantity: '½ cup (50g)' }, { name: 'egg', quantity: '1' }, { name: 'onion powder', quantity: '2 tsp.' }, { name: 'garlic, minced', quantity: '1 clove' }, { name: 'herbs de provence', quantity: '½ tsp.' }, { name: 'ground black pepper', quantity: '½ tsp.' }, { name: 'cayenne pepper', quantity: '½ tsp.' }, { name: 'chili flakes', quantity: '½ tsp.' }, { name: 'tomato sauce (passata)', quantity: '1 cup (250ml)' }, { name: 'fresh parsley, chopped', quantity: 'to taste' }], 
                instructions: '1. Preheat the oven to 400°F (200°C). 2. Combine turkey, 1 cup mozzarella, Parmesan, egg, onion powder, garlic, herbs, black pepper, cayenne and chili flakes. 3. Form meatballs, place in a dish and bake 15-20 minutes. Drain grease. 4. Pour tomato sauce over meatballs, top with remaining mozzarella and bake 5-10 minutes.', 
                tags: ['GF', 'LC', 'MP', 'HP'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_10.jpg',
                nutrition: { Prep: '10 mins', Cook: '25 mins', Kcal: 379, Fats: 23, Carbs: 3, Protein: 39, Fibre: 1 },
                storage: ''
            },
            { 
                id: 'r27', name: 'Coconut Fish Curry', category: 'Dinner', 
                ingredients: [{ name: 'olive oil', quantity: '2 tbsp.' }, { name: 'red bell pepper, sliced', quantity: '1' }, { name: 'green bell pepper, sliced', quantity: '1' }, { name: 'onion, sliced', quantity: '1' }, { name: 'salt & pepper', quantity: 'to taste' }, { name: 'curry powder', quantity: '1 ½ tbsp.' }, { name: 'garlic cloves, minced', quantity: '2' }, { name: 'root ginger, grated', quantity: '1 tbsp.' }, { name: 'cod, frozen', quantity: '1.5 lbs. (680g)' }, { name: 'coconut milk', quantity: '14 oz. (400ml)' }, { name: 'lime, juice', quantity: '1' }, { name: 'green onions, sliced', quantity: '4' }, { name: 'fresh cilantro, chopped', quantity: 'to taste' }], 
                instructions: '1. Heat olive oil in a pot over medium-high heat. Add peppers and onion, season, and sauté 4-5 minutes. 2. Add curry powder, cook 1 minute. Add garlic and ginger, cook 30 seconds. 3. Place cod on vegetables and pour coconut milk over. 4. Cover, bring to a boil, then simmer 20 minutes. 5. Adjust seasoning, add lime juice, garnish with green onions and cilantro.', 
                tags: ['GF', 'DF', 'LC', 'MP', 'HP'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_11.jpg',
                nutrition: { Prep: '10 mins', Cook: '25 mins', Kcal: 422, Fats: 27, Carbs: 11, Protein: 33, Fibre: 3 },
                storage: ''
            },
            { 
                id: 'r28', name: 'Vanilla Peach Muffins', category: 'Breakfast', 
                ingredients: [{ name: 'peach, chopped', quantity: '1 medium' }, { name: 'ground almonds', quantity: '1 ½ cups (140g)' }, { name: 'coconut flour', quantity: '2 ½ tbsp.' }, { name: 'ground cinnamon', quantity: '1 tsp.' }, { name: 'baking soda', quantity: '½ tsp.' }, { name: 'salt', quantity: '¼ tsp.' }, { name: 'eggs, beaten', quantity: '2' }, { name: 'honey', quantity: '4 tbsp.' }, { name: 'coconut oil, melted', quantity: '2 tbsp.' }, { name: 'vanilla extract', quantity: '2 tsp.' }], 
                instructions: '1. Preheat the oven to 350°F (180°C). Line a muffin tin with muffin liners. 2. Mix dry ingredients in one bowl and wet ingredients in another. 3. Fold wet into dry, add peach. 4. Spoon into 12 cases and bake 20-25 minutes until golden. 5. Cool 10 minutes before removing from liners.', 
                tags: ['GF', 'DF', 'LC', 'MP', 'V', 'N'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_12.jpg',
                nutrition: { Prep: '10 mins', Cook: '25 mins', Kcal: 137, Fats: 10, Carbs: 10, Protein: 4, Fibre: 2 },
                storage: ''
            },
            { 
                id: 'r29', name: 'Healthy Apple Cake', category: 'Treat', 
                ingredients: [{ name: 'walnuts, chopped', quantity: '¼ cup (30g)' }, { name: 'ground cinnamon', quantity: 'to garnish' }, { name: 'chai spice', quantity: '1 ½ tsp.' }, { name: 'white whole wheat flour', quantity: '1 ½ cups (190g)' }, { name: 'coconut sugar', quantity: '½ cup (100g)' }, { name: 'baking powder', quantity: '½ tsp.' }, { name: 'baking soda', quantity: '½ tsp.' }, { name: 'chai spice', quantity: '1 ½ tsp.' }, { name: 'salt', quantity: '⅛ tsp.' }, { name: 'apples, grated', quantity: '2 small' }, { name: 'unsweetened applesauce', quantity: '1 cup (250g)' }, { name: 'eggs', quantity: '2 large' }, { name: 'Greek yogurt', quantity: '4 tbsp.' }, { name: 'vanilla extract', quantity: '1 tsp.' }, { name: 'unsweetened almond milk', quantity: '½ cup (120ml)' }, { name: 'maple syrup', quantity: '½ cup (120ml)' }, { name: 'melted coconut oil', quantity: '2 tbsp.' }, { name: 'cream cheese', quantity: '½ cup (115g)' }, { name: 'fat free Greek yogurt', quantity: '½ cup (120g)' }, { name: 'maple syrup', quantity: '2 tbsp.' }], 
                instructions: '1. Preheat oven to 350°F (180°C). Line an 8×12-inch pan with baking paper. 2. Mix dry ingredients in a bowl. 3. Mix wet ingredients except coconut oil. Fold dry into wet. 4. Add melted coconut oil, pour into pan and bake 35 minutes. 5. Whip frosting ingredients. 6. Cool cake completely, spread frosting, garnish with cinnamon and walnuts.', 
                tags: ['MP', 'V', 'N'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_13.jpg',
                nutrition: { Prep: '20 mins', Cook: '30 mins', Kcal: 223, Fats: 8, Carbs: 36, Protein: 4, Fibre: 3 },
                storage: ''
            },
            { 
                id: 'r30', name: 'Hazelnut Granola Bars', category: 'Treat', 
                ingredients: [{ name: 'rolled oats', quantity: '2 cups (300g)' }, { name: 'puffed quinoa', quantity: '1 cup (30g)' }, { name: 'honey', quantity: '½ cup (120ml)' }, { name: 'coconut oil, melted', quantity: '⅓ cup (80ml)' }, { name: 'sea salt', quantity: '¼ tsp.' }, { name: 'vanilla extract', quantity: '½ tsp.' }, { name: 'chopped hazelnuts', quantity: '¼ cup (30g)' }], 
                instructions: '1. Line an 8×8-inch baking pan with baking paper. 2. Combine oats, quinoa and half the hazelnuts. 3. Heat honey and coconut oil until bubbling, remove from heat and add salt and vanilla. 4. Mix wet into dry ingredients. 5. Press mixture into pan, top with remaining hazelnuts and press. 6. Refrigerate 2 hours, slice into bars.', 
                tags: ['DF', 'MP', 'V', 'N'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_14.jpg',
                nutrition: { Prep: '10 mins', Cook: '3 mins', Kcal: 258, Fats: 11, Carbs: 37, Protein: 5, Fibre: 3 },
                storage: 'Store in an airtight container in the refrigerator for up to 1 week.'
            },
            { 
                id: 'r31', name: 'High Protein Baked Oatmeal', category: 'Breakfast', 
                ingredients: [
                    { name: 'Rolled Oats', quantity: '½ cup (40g)' }, 
                    { name: 'Banana', quantity: '½' }, 
                    { name: 'Almond Milk, unsweetened', quantity: '½ cup (120ml)' }, 
                    { name: 'Maple Syrup', quantity: '1 tbsp' }, 
                    { name: 'Vanilla Protein Powder', quantity: '1 tbsp' }, 
                    { name: 'Baking Powder', quantity: '½ tsp' },
                    { name: 'Raspberries (topping)', quantity: '¼ cup (30g)' },
                    { name: 'Vegan Chocolate Chips (topping)', quantity: '1 tbsp' },
                    { name: 'Peanut Butter, natural (topping)', quantity: '1 tbsp' }
                ], 
                instructions: '1. Preheat the oven to 350°F (180°C). 2. Blend all ingredients except toppings until smooth. 3. Transfer to an oven dish and add toppings. 4. Bake 25–30 minutes until golden, drizzle peanut butter and serve.', 
                tags: ['Dairy Free', 'Meal Prep', 'Vegetarian', 'Contains Nuts'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_15.jpg',
                nutrition: { Prep: '5 mins', Cook: '30 mins', Kcal: 469, Fats: 17, Carbs: 70, Protein: 12, Fibre: 9 },
                storage: 'Store in the refrigerator for up to 3 days.'
            }, 
            { 
                id: 'r32', name: 'Raspberry Protein Smoothie', category: 'Smoothie', 
                ingredients: [
                    { name: 'Banana', quantity: '1' }, 
                    { name: 'Frozen Raspberries', quantity: '1 cup (125g)' }, 
                    { name: 'Vanilla Protein Powder', quantity: '½ scoop (12g)' }, 
                    { name: 'Cashew Nuts', quantity: '2 tbsp' }, 
                    { name: 'Almond Milk, unsweetened', quantity: '½ cup (120ml)' }
                ], 
                instructions: '1. Blend all ingredients until smooth. 2. Serve immediately.', 
                tags: ['Gluten Free', 'Dairy Free', 'Vegetarian', 'Quick', 'Contains Nuts'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_16.jpg',
                nutrition: { Prep: '5 mins', Cook: '0 mins', Kcal: 326, Fats: 10, Carbs: 49, Protein: 16, Fibre: 9 },
                storage: 'Best served immediately.'
            }, 
            { 
                id: 'r33', name: 'Chickpea & Avocado Toast', category: 'Breakfast', 
                ingredients: [
                    { name: 'Chickpeas, drained', quantity: '1 cup (165g)' },
                    { name: 'Olive Oil', quantity: '1 tbsp' },
                    { name: 'Salt', quantity: '¼ tsp' },
                    { name: 'Black Pepper', quantity: '¼ tsp' },
                    { name: 'Ground Cumin', quantity: '1 tsp' },
                    { name: 'Avocado', quantity: '1' },
                    { name: 'Tahini', quantity: '1 tbsp' },
                    { name: 'Lemon Juice', quantity: '½ lemon' },
                    { name: 'Bread, toasted', quantity: '2 slices' },
                    { name: 'Fresh Parsley, chopped', quantity: '2 tbsp' }
                ], 
                instructions: '1. Roast chickpeas with olive oil, cumin, salt and pepper at 390°F (200°C) for 15–20 minutes. 2. Mash avocado with lemon juice and tahini. 3. Spread avocado on toast, top with chickpeas and parsley.', 
                tags: ['Dairy Free', 'Vegetarian'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_17.jpg',
                nutrition: { Prep: '10 mins', Cook: '20 mins', Kcal: 484, Fats: 30, Carbs: 46, Protein: 13, Fibre: 15 },
                storage: 'Best eaten fresh. Roasted chickpeas can be stored 3 days.'
            }, 
            { 
                id: 'r34', name: 'Breakfast Pancakes With Harissa Roasted Veggies', category: 'Breakfast', 
                ingredients: [
                    { name: 'Buckwheat Flour', quantity: '1¼ cup (150g)' },
                    { name: 'Chili Powder', quantity: '1 tsp' },
                    { name: 'Paprika', quantity: '1 tsp' },
                    { name: 'Water', quantity: '1 cup (240ml)' },
                    { name: 'Olive Oil', quantity: '4 tsp' },
                    { name: 'Eggplant, chopped', quantity: '1' },
                    { name: 'Zucchini, chopped', quantity: '1 small' },
                    { name: 'Chickpeas, drained', quantity: '1 can (400g)' },
                    { name: 'Paprika', quantity: '1 tsp' },
                    { name: 'Tomatoes, chopped', quantity: '2 large' },
                    { name: 'Harissa Paste', quantity: '1 tbsp' },
                    { name: 'Tahini', quantity: '1 tbsp' },
                    { name: 'Lemon Juice', quantity: '1 lemon' },
                    { name: 'Fresh Parsley, chopped', quantity: '2 tbsp' }
                ], 
                instructions: '1. Roast veggies with spices at 375°F (190°C) for 25 minutes, add tomatoes and roast 10 more minutes. 2. Mix pancake batter and cook 4 pancakes. 3. Mix roasted vegetables with harissa, tahini and lemon. 4. Serve veggies over pancakes.', 
                tags: ['Gluten Free', 'Dairy Free', 'Meal Prep', 'Vegetarian'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_18.jpg',
                nutrition: { Prep: '15 mins', Cook: '45 mins', Kcal: 340, Fats: 10, Carbs: 55, Protein: 14, Fibre: 15 },
                storage: 'Store vegetables and pancakes separately up to 3 days.'
            }, 
            { 
                id: 'r35', name: 'Healthy Homemade Ketchup', category: 'Condiment', 
                ingredients: [
                    { name: 'Tomato Sauce (Passata)', quantity: '1 cup (240g)' },
                    { name: 'Apple Cider Vinegar', quantity: '¼ cup (60ml)' },
                    { name: 'Ground Allspice', quantity: '⅛ tsp' },
                    { name: 'Ground Cloves', quantity: '⅛ tsp' },
                    { name: 'Ground Cinnamon', quantity: '¼ tsp' },
                    { name: 'Maple Syrup', quantity: '1 tbsp' },
                    { name: 'Sea Salt', quantity: '1 tsp' },
                    { name: 'Black Pepper', quantity: '¼ tsp' }
                ], 
                instructions: '1. Simmer all ingredients on low for 10 minutes. Add water if needed. 2. Store in a glass jar and refrigerate up to one month.', 
                tags: ['Gluten Free', 'Dairy Free', 'Low Carb', 'Meal Prep', 'Vegetarian', 'Quick'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_19.jpg',
                nutrition: { Prep: '5 mins', Cook: '10 mins', Kcal: 14, Fats: 0, Carbs: 3, Protein: 0, Fibre: 1 },
                storage: 'Store in the refrigerator for up to 1 month.'
            }, 
            { 
                id: 'r36', name: 'Baked Zucchini Sticks', category: 'Snack', 
                ingredients: [
                    { name: 'Zucchini', quantity: '1' },
                    { name: 'Chickpea Flour', quantity: '1 cup (90g)' },
                    { name: 'Almond Milk, unsweetened', quantity: '¾ cup (180ml)' },
                    { name: 'Cornstarch', quantity: '½ cup (65g)' },
                    { name: 'Cornflakes, crushed', quantity: '½ cup (30g)' },
                    { name: 'Garlic Granules', quantity: '1 tsp' },
                    { name: 'Salt & Pepper', quantity: 'to taste' }
                ], 
                instructions: '1. Cut zucchini into sticks. 2. Mix batter with chickpea flour, cornstarch, milk and spices. 3. Coat in batter then cornflakes. 4. Bake at 400°F (200°C) for 25 minutes.', 
                tags: ['Dairy Free', 'Meal Prep', 'Vegetarian'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_20.jpg',
                nutrition: { Prep: '5 mins', Cook: '25 mins', Kcal: 382, Fats: 5, Carbs: 69, Protein: 13, Fibre: 9 },
                storage: 'Store for 2 days. Reheat in oven for crispiness.'
            }, 
            { 
                id: 'r37', name: 'Watermelon Poke Bowl', category: 'Lunch', 
                ingredients: [
                    { name: 'Watermelon, cubed', quantity: '2 cups (300g)' },
                    { name: 'Tamari Sauce', quantity: '6 tbsp' },
                    { name: 'Rice Vinegar', quantity: '2 tsp' },
                    { name: 'Sesame Oil', quantity: '1 tbsp' },
                    { name: 'Lime Juice', quantity: '1 lime' },
                    { name: 'Maple Syrup', quantity: '1 tbsp' },
                    { name: 'Green Onions, sliced', quantity: '2' },
                    { name: 'Ginger, grated', quantity: '2 tbsp' },
                    { name: 'Sesame Seeds', quantity: '2 tbsp' },
                    { name: 'Chili Flakes', quantity: '1 tsp' },
                    { name: 'Soy Yogurt', quantity: '3 tbsp' },
                    { name: 'Sriracha Sauce', quantity: '1 tbsp' },
                    { name: 'Cooked Rice', quantity: '9 oz (250g)' },
                    { name: 'Cucumber, sliced', quantity: '½' },
                    { name: 'Avocado, sliced', quantity: '1' },
                    { name: 'Edamame Beans', quantity: '½ cup (60g)' },
                    { name: 'Nori, chopped', quantity: '1 tbsp' },
                    { name: 'Black Sesame Seeds', quantity: '1 tbsp' }
                ], 
                instructions: '1. Mix marinade ingredients and marinate watermelon 1 hour. 2. Mix yogurt and sriracha. 3. Assemble bowls with rice, watermelon, vegetables and sauce.', 
                tags: ['Gluten Free', 'Dairy Free', 'Meal Prep', 'Vegetarian'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_21.jpg',
                nutrition: { Prep: '20 mins', Cook: '0 mins', Kcal: 373, Fats: 16, Carbs: 51, Protein: 10, Fibre: 6 },
                storage: 'Store ingredients separately for 2 days.'
            }, 
            { 
                id: 'r38', name: 'Chickpea & Couscous Salad', category: 'Lunch', 
                ingredients: [
                    { name: 'Couscous', quantity: '½ cup (85g)' },
                    { name: 'Chickpeas, drained', quantity: '1 can (400g)' },
                    { name: 'Cucumber, sliced', quantity: '½' },
                    { name: 'Red Onion, diced', quantity: '½' },
                    { name: 'Cherry Tomatoes, halved', quantity: '1 cup (150g)' },
                    { name: 'Rocket Leaves', quantity: '7 oz (200g)' },
                    { name: 'Hummus', quantity: '4 tbsp' },
                    { name: 'Apple Cider Vinegar', quantity: '1 tbsp' },
                    { name: 'Lemon Juice', quantity: '1 tbsp' },
                    { name: 'Olive Oil', quantity: '1 tbsp' },
                    { name: 'Maple Syrup', quantity: '1 tsp' },
                    { name: 'Dijon Mustard', quantity: '1 tsp' }
                ], 
                instructions: '1. Cook couscous and cool. 2. Mix dressing. 3. Toss all salad ingredients with dressing. 4. Serve with hummus.', 
                tags: ['Dairy Free', 'Meal Prep', 'Vegetarian', 'Quick'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_22.jpg',
                nutrition: { Prep: '20 mins', Cook: '0 mins', Kcal: 351, Fats: 12, Carbs: 51, Protein: 10, Fibre: 10 },
                storage: 'Store refrigerated for up to 2 days.'
            }, 
            { 
                id: 'r39', name: 'Super Green Soup', category: 'Dinner', 
                ingredients: [
                    { name: 'Olive Oil', quantity: '1 tbsp' },
                    { name: 'Garlic, minced', quantity: '2 cloves' },
                    { name: 'Ground Cumin', quantity: '2 tsp' },
                    { name: 'Vegetable Broth', quantity: '2½ cups (600ml)' },
                    { name: 'Broccoli, in florets', quantity: '1 large head' },
                    { name: 'Spinach', quantity: '7 oz (200g)' },
                    { name: 'Cannellini Beans, drained', quantity: '1 can (400g)' },
                    { name: 'Fresh Cilantro, chopped', quantity: '4 tbsp' },
                    { name: 'Lemon Juice', quantity: '½ lemon' },
                    { name: 'Oat Cream', quantity: '5 tbsp' }
                ], 
                instructions: '1. Cook garlic and cumin in oil. Add broth and broccoli and simmer 10 minutes. 2. Add remaining ingredients except cream and cook 10 minutes. 3. Blend smooth and serve with oat cream.', 
                tags: ['Gluten Free', 'Dairy Free', 'Low Carb', 'Meal Prep', 'Vegetarian', 'Quick'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_23.jpg',
                nutrition: { Prep: '5 mins', Cook: '22 mins', Kcal: 181, Fats: 8, Carbs: 24, Protein: 8, Fibre: 7 },
                storage: 'Store refrigerated for 3 days or freeze for 2 months.'
            }, 
            { 
                id: 'r40', name: 'Smoky Tomato & Bean Stew', category: 'Dinner', 
                ingredients: [
                    { name: 'Garlic, minced', quantity: '2 cloves' },
                    { name: 'Sundried Tomatoes', quantity: '½ cup (55g)' },
                    { name: 'Smoked Paprika', quantity: '1 tsp' },
                    { name: 'Cannellini Beans, drained', quantity: '1 can (400g)' },
                    { name: 'Chopped Tomatoes, canned', quantity: '1 can (400g)' },
                    { name: 'Maple Syrup', quantity: '1 tbsp' },
                    { name: 'Cooked Rice', quantity: '3 cups (480g)' },
                    { name: 'Lambs Lettuce', quantity: '4 handfuls' },
                    { name: 'Soy Yogurt', quantity: '4 tbsp' }
                ], 
                instructions: '1. Cook rice. 2. Sauté garlic and sundried tomatoes, add paprika. 3. Add beans, tomatoes and maple syrup; simmer 10 minutes. 4. Serve over rice with greens and yogurt.', 
                tags: ['Gluten Free', 'Dairy Free', 'Meal Prep', 'Vegetarian', 'Quick'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_24.jpg',
                nutrition: { Prep: '5 mins', Cook: '15 mins', Kcal: 278, Fats: 1, Carbs: 59, Protein: 9, Fibre: 6 },
                storage: 'Store up to 3 days in the refrigerator.'
            }, 
            { 
                id: 'r41', name: 'Easy Vegan Nasi Goreng', category: 'Dinner', 
                ingredients: [
                    { name: 'Cooked Brown Rice', quantity: '2 cups (400g)' },
                    { name: 'Coconut Oil', quantity: '1 tbsp' },
                    { name: 'Onion, chopped', quantity: '1' },
                    { name: 'Garlic, chopped', quantity: '2 cloves' },
                    { name: 'Ginger, grated', quantity: '¾ inch (2cm)' },
                    { name: 'Pak Choy, sliced', quantity: '1 small' },
                    { name: 'Carrots, finely chopped', quantity: '2' },
                    { name: 'Silken Tofu, crumbled', quantity: '10.5 oz (300g)' },
                    { name: 'Tamari Sauce', quantity: '4 tbsp' },
                    { name: 'Rice Vinegar', quantity: '2 tbsp' },
                    { name: 'Peanuts, chopped', quantity: '¼ cup (36g)' },
                    { name: 'Green Onions, sliced', quantity: '3' },
                    { name: 'Cucumber, sliced', quantity: '½' },
                    { name: 'Tomato, sliced', quantity: '1' }
                ], 
                instructions: '1. Sauté onion, garlic and ginger in coconut oil. 2. Add carrots and pak choy and cook. 3. Add rice, tofu, tamari and rice vinegar and fry 5 minutes. 4. Serve with peanuts, green onions, cucumber and tomato.', 
                tags: ['Gluten Free', 'Dairy Free', 'Meal Prep', 'Vegetarian', 'Quick', 'Contains Nuts'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_25.jpg',
                nutrition: { Prep: '10 mins', Cook: '13 mins', Kcal: 287, Fats: 11, Carbs: 35, Protein: 14, Fibre: 4 },
                storage: 'Store up to 3 days.'
            }, 
            { 
                id: 'r42', name: 'Creamy Sundried Tomato Pasta', category: 'Dinner', 
                ingredients: [
                    { name: 'Pasta of Choice', quantity: '10.5 oz (300g)' },
                    { name: 'Sundried Tomatoes, chopped', quantity: '½ cup (55g)' },
                    { name: 'Garlic, minced', quantity: '2 cloves' },
                    { name: 'Fresh Basil, chopped', quantity: '4 tbsp' },
                    { name: 'Chili Flakes', quantity: '¼ tsp' },
                    { name: 'Cashew Nuts', quantity: '1 cup (140g)' },
                    { name: 'Almond Milk, unsweetened', quantity: '1½ cups (350ml)' },
                    { name: 'Nutritional Yeast', quantity: '2 tbsp' },
                    { name: 'Salt', quantity: '2 tsp' }
                ], 
                instructions: '1. Cook pasta. 2. Boil cashews 5 minutes and blend with sauce ingredients. 3. Sauté sundried tomatoes and garlic, add sauce and basil. 4. Mix in pasta and serve.', 
                tags: ['Gluten Free', 'Dairy Free', 'Meal Prep', 'Vegetarian', 'Quick', 'Contains Nuts'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_26.jpg',
                nutrition: { Prep: '5 mins', Cook: '15 mins', Kcal: 551, Fats: 20, Carbs: 80, Protein: 16, Fibre: 8 },
                storage: 'Store up to 3 days.'
            }, 
            { 
                id: 'r43', name: 'Digestive Biscuits', category: 'Snack', 
                ingredients: [
                    { name: 'Oat Flour', quantity: '2.6 oz (75g)' },
                    { name: 'White Rice Flour', quantity: '2.6 oz (75g)' },
                    { name: 'Coconut Sugar', quantity: '6 tbsp' },
                    { name: 'Baking Powder', quantity: '1 tsp' },
                    { name: 'Salt', quantity: 'pinch' },
                    { name: 'Ground Cardamom', quantity: '¼ tsp' },
                    { name: 'Ground Cinnamon', quantity: '¼ tsp' },
                    { name: 'Coconut Oil, melted', quantity: '2 tbsp' },
                    { name: 'Oat Milk', quantity: '4 tbsp' }
                ], 
                instructions: '1. Preheat oven to 360°F (180°C). 2. Mix ingredients into dough and form 8 balls. Flatten. 3. Bake 12–15 minutes and cool on rack.', 
                tags: ['Dairy Free', 'Meal Prep', 'Vegetarian', 'Quick'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_27.jpg',
                nutrition: { Prep: '10 mins', Cook: '15 mins', Kcal: 94, Fats: 1, Carbs: 20, Protein: 2, Fibre: 1 },
                storage: 'Store in an airtight container up to 5 days.'
            }, 
            { 
                id: 'r44', name: '3-Ingredient Berry Mousse', category: 'Dessert', 
                ingredients: [
                    { name: 'Mixed Berries', quantity: '1½ cups (220g)' },
                    { name: 'Silken Tofu', quantity: '14 oz (400g)' },
                    { name: 'Maple Syrup', quantity: '2 tbsp' }
                ], 
                instructions: '1. Blend all ingredients until smooth. 2. Divide into glasses and chill 1 hour. 3. Serve with fresh berries.', 
                tags: ['Gluten Free', 'Dairy Free', 'Meal Prep', 'Vegetarian'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_28.jpg',
                nutrition: { Prep: '5 mins', Cook: '0 mins', Kcal: 211, Fats: 5, Carbs: 26, Protein: 15, Fibre: 5 },
                storage: 'Store refrigerated for up to 3 days.'
            }, 
            { 
                id: 'r45', name: 'Vegan Banana Bread', category: 'Dessert', 
                ingredients: [
                    { name: 'Bananas, ripe', quantity: '2' },
                    { name: 'Maple Syrup', quantity: '1 tbsp' },
                    { name: 'Oat Flour', quantity: '¾ cup (67g)' },
                    { name: 'Buckwheat Flour', quantity: '6 tbsp' },
                    { name: 'Ground Cardamom', quantity: '½ tsp' },
                    { name: 'Ground Cinnamon', quantity: '½ tsp' },
                    { name: 'Baking Powder', quantity: '1¼ tsp' },
                    { name: 'Salt', quantity: 'pinch' }
                ], 
                instructions: '1. Preheat oven to 350°F (170°C). 2. Blend bananas and syrup. 3. Mix dry ingredients and fold in banana mixture. 4. Bake 60–65 minutes until a toothpick comes out clean.', 
                tags: ['Dairy Free', 'Low Carb', 'Meal Prep', 'Vegetarian'], 
                image: 'https://raw.githubusercontent.com/pet6988888888/images/refs/heads/main/Screenshot_29.jpg',
                nutrition: { Prep: '10 mins', Cook: '60 mins', Kcal: 70, Fats: 1, Carbs: 15, Protein: 2, Fibre: 2 },
                storage: 'Store 4 days in refrigerator or freeze for 2 months.'
            },

            // ... all recipes as before (unchanged) ...
            // Due to space constraints, assume all recipes from original mealplan.html are here unchanged
        ];

        const MEAL_TYPES = ['Breakfast', 'Lunch', 'Dinner', 'Snack'];
        const DAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
        const TOTAL_SLOTS = DAYS.length * MEAL_TYPES.length;
        
        let mealPlan = DAYS.reduce((acc, day) => {
            acc[day] = MEAL_TYPES.reduce((mealAcc, meal) => {
                mealAcc[meal] = null; // Stores the recipe ID
                return mealAcc;
            }, {});
            return acc;
        }, {});

        let currentSelection = { day: null, meal: null };
        let selectedTags = new Set(); // State for active tag filters
        let coverImageDataUrl = null; // New state for cover image

        // --- Utility Functions ---

        /**
         * Assigns an ingredient to a category based on the FINAL_CATEGORIES map.
         * @param {string} ingredientName - The full name of the ingredient.
         * @returns {string} The assigned category or 'Misc'.
         */
        function categorizeIngredient(ingredientName) {
            const lowerName = ingredientName.toLowerCase();
            
            for (const category in FINAL_CATEGORIES) {
                const keywords = FINAL_CATEGORIES[category];
                // Check if the ingredient name contains any of the category keywords
                if (keywords.some(keyword => lowerName.includes(keyword))) {
                    return category;
                }
            }
            return 'Misc';
        }

        /**
         * Finds a recipe object by its ID.
         * @param {string} id - The recipe ID.
         * @returns {object|null} The recipe object or null.
         */
        function getRecipeById(id) {
            return RECIPES.find(r => r.id === id) || null;
        }

        /**
         * Updates the status counter displayed at the top of the app.
         */
        function updatePlanStatus() {
            let filledCount = 0;
            const uniqueRecipeIds = new Set();

            for (const day of DAYS) {
                for (const meal of MEAL_TYPES) {
                    const recipeId = mealPlan[day][meal];
                    if (recipeId) {
                        filledCount++;
                        uniqueRecipeIds.add(recipeId);
                    }
                }
            }

            document.getElementById('filledSlots').textContent = `Meals Planned: ${filledCount} / ${TOTAL_SLOTS}`;
            document.getElementById('uniqueRecipes').textContent = `Unique Recipes Used: ${uniqueRecipeIds.size}`;
        }

        /**
         * Renders the main meal plan grid.
         */
        function renderMealPlan() {
            const body = document.getElementById('mealPlanBody');
            body.innerHTML = ''; // Clear existing content

            DAYS.forEach(day => {
                const row = document.createElement('tr');
                // Use dark theme hover class
                row.className = 'hover:bg-slate-700 transition duration-100';

                // Day column
                // Updated text color for prominence in dark theme
                let html = `<td class="px-2 py-2 whitespace-nowrap font-bold text-teal-400">${day}</td>`;

                MEAL_TYPES.forEach(meal => {
                    const recipeId = mealPlan[day][meal];
                    const recipe = getRecipeById(recipeId);
                    
                    html += `
                        <td 
                            data-day="${day}" 
                            data-meal="${meal}"
                            class="meal-slot ${recipe ? 'filled' : ''} cursor-pointer p-2 border-l border-slate-700 text-sm text-slate-200 rounded-lg hover:shadow-lg transition duration-150"
                            onclick="openModal('${day}', '${meal}')"
                        >
                            <span class="font-medium">${recipe ? recipe.name : 'Click to Add'}</span>
                            ${recipe ? '<button onclick="event.stopPropagation(); removeRecipe(\''+day+'\', \''+meal+'\')" class="ml-1 text-red-400 hover:text-red-300 font-bold text-xs">x</button>' : ''}
                        </td>
                    `;
                });
                
                row.innerHTML = html;
                body.appendChild(row);
            });
            updatePlanStatus(); // Update status whenever the grid changes
        }

        /**
         * Displays a notification message.
         * @param {string} message - The message to display.
         * @param {string} type - The type of message ('success' or 'error').
         */
        function showNotification(message, type) {
            const notificationArea = document.getElementById('notificationArea');
            // Use dark theme appropriate colors for notification
            const bgClass = type === 'error' ? 'bg-red-900 text-red-200 border-red-400' : 'bg-green-900 text-green-200 border-green-400';
            
            notificationArea.innerHTML = `<div class="p-6 ${bgClass} rounded-xl shadow-2xl border">${message}</div>`;
            notificationArea.classList.remove('hidden');
            notificationArea.classList.add('flex');

            setTimeout(() => {
                notificationArea.classList.add('hidden');
                notificationArea.classList.remove('flex');
                notificationArea.innerHTML = '';
            }, 3000);
        }

        /**
         * Opens the recipe selection modal.
         */
        function openModal(day, meal) {
            currentSelection = { day, meal };
            document.getElementById('modalTitleSlot').textContent = `${meal} on ${day}`;
            
            // Set the category filter to match the meal type by default
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.value = meal; 
            
            // Reset and apply filters
            selectedTags.clear();
            renderTagButtons(); // Re-render tag buttons to clear active state
            filterRecipes();

            document.getElementById('recipeModal').classList.remove('hidden');
            document.getElementById('recipeModal').classList.add('flex');
        }

        /**
         * Closes the recipe selection modal.
         */
        function closeModal() {
            document.getElementById('recipeModal').classList.add('hidden');
            document.getElementById('recipeModal').classList.remove('flex');
            
            // Clear filters when closing
            document.getElementById('categoryFilter').value = '';
            selectedTags.clear();
            renderTagButtons();
        }

        /**
         * Adds a selected recipe to the meal plan and closes the modal.
         */
        function selectRecipe(recipeId) {
            mealPlan[currentSelection.day][currentSelection.meal] = recipeId;
            renderMealPlan();
            closeModal();
        }

        /**
         * Removes a recipe from the meal plan.
         */
        function removeRecipe(day, meal) {
            mealPlan[day][meal] = null;
            renderMealPlan();
        }

        /**
         * Toggles the active state of a tag filter, updates the button, and re-filters the recipes.
         * @param {string} tag - The tag to toggle.
         */
        function toggleTagFilter(tag) {
            const button = document.querySelector(`[data-tag="${tag}"]`);
            if (selectedTags.has(tag)) {
                selectedTags.delete(tag);
                button.classList.remove('active');
            } else {
                selectedTags.add(tag);
                button.classList.add('active');
            }
            filterRecipes();
        }

        /**
         * Filters the recipe list based on selected category and active tags.
         */
        function filterRecipes() {
            const listContainer = document.getElementById('recipeList');
            const category = document.getElementById('categoryFilter').value;
            const activeTags = Array.from(selectedTags);

            const filtered = RECIPES.filter(recipe => {
                const categoryMatch = !category || recipe.category === category;
                
                // Tag match: recipe must contain ALL selected active tags (AND logic)
                const tagMatch = activeTags.every(tag => recipe.tags.includes(tag));

                return categoryMatch && tagMatch;
            });

            listContainer.innerHTML = filtered.map(recipe => `
                <div 
                    class="p-4 bg-slate-900 border border-slate-700 rounded-xl cursor-pointer hover:bg-teal-900 transition duration-150 shadow-md"
                    onclick="selectRecipe('${recipe.id}')"
                >
                    <div class="flex items-start gap-4">
                        <!-- Thumbnail Image -->
                        <img 
                            src="${recipe.image}" 
                            alt="${recipe.name}" 
                            class="w-20 h-20 object-cover rounded-lg flex-shrink-0"
                            onerror="this.onerror=null; this.src='https://placehold.co/80x80/cccccc/000000?text=Food';"
                        />
                        
                        <!-- Recipe Details -->
                        <div class="flex-grow">
                            <h3 class="font-bold text-lg text-teal-400 mb-1">${recipe.name}</h3>
                            <div class="text-xs text-slate-400 mb-2 italic flex flex-wrap gap-1">
                                Category: ${recipe.category} |
                                <!-- Limit visible tags to 3 for compactness -->
                                ${recipe.tags.slice(0, 3).map(tag => `<span class="px-2 py-0.5 bg-slate-700 text-slate-300 rounded-full font-medium text-xs">${tag}</span>`).join('')}
                            </div>

                            <!-- Quick Nutrition Preview -->
                            <div class="flex flex-wrap gap-2 text-center text-sm font-semibold mt-2">
                                <div class="bg-indigo-700 text-indigo-200 px-2 py-1 rounded-full">
                                    Kcal: ${recipe.nutrition.Kcal}
                                </div>
                                <div class="bg-teal-700 text-teal-200 px-2 py-1 rounded-full">
                                    Protein: ${recipe.nutrition.Protein}g
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            if (filtered.length === 0) {
                listContainer.innerHTML = '<p class="text-center text-slate-400 p-4">No recipes match your filter criteria.</p>';
            }
        }

        /**
         * Renders the tag buttons based on the fixed CURATED_TAGS list.
         */
        function renderTagButtons() {
            const tagContainer = document.getElementById('tagButtonContainer');
            tagContainer.innerHTML = '';
            
            // Use the fixed CURATED_TAGS list
            CURATED_TAGS.forEach(tag => {
                const button = document.createElement('button');
                button.textContent = tag;
                button.setAttribute('data-tag', tag);
                button.onclick = () => toggleTagFilter(tag);
                
                let iconClass = 'bg-slate-600 text-slate-200 hover:bg-slate-500';
                
                // Add specific color for important tags (dark theme contrast adjusted)
                if (tag === 'High Protein') {
                    iconClass = 'bg-blue-800 text-blue-200 hover:bg-blue-700';
                } else if (tag === 'Low Carb') {
                    iconClass = 'bg-indigo-800 text-indigo-200 hover:bg-indigo-700';
                } else if (tag === 'Vegetarian') {
                    iconClass = 'bg-green-800 text-green-200 hover:bg-green-700';
                } else if (tag === 'Quick') {
                    iconClass = 'bg-yellow-800 text-yellow-200 hover:bg-yellow-700';
                } else if (tag === 'Gluten Free') {
                    iconClass = 'bg-pink-800 text-pink-200 hover:bg-pink-700';
                } else if (tag === 'Dairy Free') {
                    iconClass = 'bg-red-800 text-red-200 hover:bg-red-700';
                } else if (tag === 'Meal Prep/Freezer Friendly') {
                    iconClass = 'bg-purple-800 text-purple-200 hover:bg-purple-700';
                } else if (tag === 'Contains Nuts') {
                    iconClass = 'bg-amber-800 text-amber-200 hover:bg-amber-700';
                }
                
                button.className = `tag-button px-3 py-1 rounded-full text-xs font-semibold ${iconClass} transition duration-150 whitespace-nowrap`;
                
                if (selectedTags.has(tag)) {
                    button.classList.add('active');
                }

                tagContainer.appendChild(button);
            });
        }


        /**
         * Aggregates and categorizes ingredients into a shopping list structure.
         * @returns {object} Categorized shopping list object.
         */
        function generateShoppingList() {
            const selectedRecipeIds = new Set();
            for (const day of DAYS) {
                for (const meal of MEAL_TYPES) {
                    if (mealPlan[day][meal]) {
                        selectedRecipeIds.add(mealPlan[day][meal]);
                    }
                }
            }

            // Temporary flat list to aggregate quantities
            const flatShoppingList = {};

            selectedRecipeIds.forEach(id => {
                const recipe = getRecipeById(id);
                if (recipe && recipe.ingredients) {
                    recipe.ingredients.forEach(item => {
                        const name = item.name.trim();
                        if (flatShoppingList[name]) {
                            flatShoppingList[name].quantities.push(item.quantity);
                        } else {
                            flatShoppingList[name] = {
                                quantities: [item.quantity],
                                category: categorizeIngredient(name)
                            };
                        }
                    });
                }
            });
            
            // Final categorized list structure, initialized with defined categories
            const categorizedShoppingList = {};
            SHOPPING_CATEGORIES_ORDER.forEach(cat => categorizedShoppingList[cat] = []);

            // Populate the categorized list
            for (const name in flatShoppingList) {
                const item = flatShoppingList[name];
                
                let category = item.category;
                
                // If a category exists in the FINAL_CATEGORIES map, push the item there.
                if (categorizedShoppingList[category]) {
                    categorizedShoppingList[category].push({ name: name, quantities: item.quantities });
                } else {
                    // This handles the 'Misc' fallback implicitly if categorization fails
                    categorizedShoppingList['Misc'].push({ name: name, quantities: item.quantities });
                }
            }

            // Sort items within each category alphabetically
            for (const category in categorizedShoppingList) {
                categorizedShoppingList[category].sort((a, b) => a.name.localeCompare(b.name));
            }

            return categorizedShoppingList;
        }

        /**
         * Closes the printable text output modal.
         */
        function closePrintOutputModal() {
            document.getElementById('printOutputModal').classList.add('hidden');
            document.getElementById('printOutputModal').classList.remove('flex');
            document.getElementById('outputContentDiv').innerHTML = ''; // Clear content
        }

        /**
         * Helper to split instructions string into a list of steps.
         * @param {string} instructionsString - The combined string of instructions.
         * @returns {string[]} An array of steps.
         */
        function parseInstructions(instructionsString) {
            // Splits by pattern: "1. ", "2. ", etc., and filters out empty strings.
            const steps = instructionsString.split(/\d+\.\s/).filter(s => s.trim() !== '');
            return steps;
        }

        /**
         * Generates the final document as clean, styled HTML optimized for PDF printing.
         * @returns {string} The styled HTML content.
         */
        function generateStyledHTMLForPrint() {
            const selectedRecipeIds = new Set();
            const shoppingList = generateShoppingList();
            
            for (const day of DAYS) {
                for (const meal of MEAL_TYPES) {
                    if (mealPlan[day][meal]) {
                        selectedRecipeIds.add(mealPlan[day][meal]);
                    }
                }
            }

            // --- Generate Shopping List HTML by Category ---
            let shoppingListHTML = '';
            SHOPPING_CATEGORIES_ORDER.forEach(category => {
                const items = shoppingList[category] || []; // Get the items for the current category
                
                if (items.length > 0) {
                    shoppingListHTML += `
                        <div class="mb-6">
                            <h3 class="text-xl font-bold text-teal-700 mb-2 border-b border-gray-100">${category}</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2">
                                ${items.map(item => `
                                    <div class="flex items-start space-x-3 text-gray-700">
                                        <span class="text-teal-500 text-xl font-bold">✓</span>
                                        <p class="text-base">
                                            <span class="font-semibold">${item.name}:</span> 
                                            <span class="text-sm italic">${item.quantities.join(' + ')}</span>
                                        </p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            
            // --- Compile Full Document HTML ---
            let htmlContent = `
                <div class="space-y-12 print:text-black font-['Inter']">
                    <!-- Cover Page (if uploaded) -->
                    ${coverImageDataUrl ? `
                    <div id="coverImage" style="page-break-after: always; text-align: center;">
                        <img src="${coverImageDataUrl}" alt="Meal Plan Cover" style="width: 100%; max-width: 800px; height: auto; margin: 0 auto;">
                    </div>
                    ` : ''}

                    <!-- Title Section -->
                    <div class="text-center pb-4 border-b-4 border-teal-500">
                        <h1 class="font-['Playfair_Display'] text-5xl font-extrabold text-teal-700">The 7-Day Meal Plan</h1>
                        <p class="text-lg text-gray-600 mt-2">Prepared on ${new Date().toLocaleDateString()} • Your guide to healthy eating.</p>
                    </div>

                    <!-- Weekly Schedule -->
                    <div>
                        <h2 class="font-['Playfair_Display'] text-3xl font-bold text-gray-800 border-b-2 border-gray-200 pb-2 mb-4">1. Weekly Schedule</h2>
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-teal-100 border-b border-t">
                                    <th class="py-2 text-left px-3 text-sm font-bold text-teal-800 w-1/12">DAY</th>
                                    ${MEAL_TYPES.map(m => `<th class="py-2 text-left px-3 text-sm font-bold text-teal-800">${m.toUpperCase()}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${DAYS.map(day => {
                                    // Only render rows for days with content, for cleaner print output
                                    const hasContent = MEAL_TYPES.some(meal => mealPlan[day][meal]);
                                    if (!hasContent) return ''; 
                                    return `
                                        <tr class="border-b hover:bg-gray-50">
                                            <td class="py-2 px-3 font-bold text-gray-800">${day}</td>
                                            ${MEAL_TYPES.map(meal => {
                                                const recipe = getRecipeById(mealPlan[day][meal]);
                                                return `<td class="py-2 px-3 text-sm text-gray-700">${recipe ? recipe.name : '—'}</td>`;
                                            }).join('')}
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>

                    <!-- Shopping List (NOW CATEGORIZED) -->
                    <div style="break-before: page;">
                        <h2 class="font-['Playfair_Display'] text-3xl font-bold text-gray-800 border-b-2 border-gray-200 pb-2 mb-4">2. Consolidated Shopping List</h2>
                        <div class="space-y-4">
                            ${shoppingListHTML}
                        </div>
                    </div>

                    <!-- Recipe Details -->
                    <div style="break-before: page;">
                        <h2 class="font-['Playfair_Display'] text-3xl font-bold text-gray-800 border-b-2 border-gray-200 pb-2 mb-6">3. Recipe Details</h2>
                        <div class="space-y-12">
                            ${Array.from(selectedRecipeIds).map((id, index) => {
                                const recipe = getRecipeById(id);
                                if (!recipe) return '';

                                // Parse instructions into steps for list formatting
                                const steps = parseInstructions(recipe.instructions);

                                return `
                                    <div class="p-6 border-2 border-gray-100 rounded-xl bg-white recipe-card-print">
                                        <h3 class="font-['Playfair_Display'] text-3xl font-extrabold text-blue-700 mb-2">${recipe.name}</h3>
                                        <p class="text-sm text-gray-500 mb-4 italic font-semibold">Category: ${recipe.category} | Tags: ${recipe.tags.join(', ')}</p>
                                        
                                        <!-- Prep/Cook/Nutrition Grid -->
                                        <div class="grid grid-cols-2 sm:grid-cols-5 gap-2 text-center p-3 mb-4 bg-teal-50 rounded-lg">
                                            <div class="font-bold text-teal-800 text-xs uppercase">Prep: <span class="block text-sm font-semibold text-gray-800">${recipe.nutrition.Prep}</span></div>
                                            <div class="font-bold text-teal-800 text-xs uppercase">Cook: <span class="block text-sm font-semibold text-gray-800">${recipe.nutrition.Cook}</span></div>
                                            <div class="font-bold text-teal-800 text-xs uppercase">Kcal: <span class="block text-sm font-semibold text-gray-800">${recipe.nutrition.Kcal}</span></div>
                                            <div class="font-bold text-teal-800 text-xs uppercase">Protein: <span class="block text-sm font-semibold text-gray-800">${recipe.nutrition.Protein}g</span></div>
                                            <div class="font-bold text-teal-800 text-xs uppercase">Fibre: <span class="block text-sm font-semibold text-gray-800">${recipe.nutrition.Fibre}g</span></div>
                                        </div>

                                        <div class="flex flex-col sm:flex-row gap-6">
                                            <!-- Left Column: Image and Ingredients -->
                                            <div class="sm:w-1/3 space-y-4">
                                                <img src="${recipe.image}" alt="Image of ${recipe.name}" class="w-full h-auto rounded-lg shadow-lg recipe-image" onerror="this.onerror=null; this.src='https://placehold.co/300x200/cccccc/000000?text=Recipe+Image';" />

                                                <h4 class="text-xl font-bold text-teal-600 mb-2 border-b border-teal-300">INGREDIENTS</h4>
                                                <ul class="list-disc list-inside space-y-1 text-gray-700">
                                                    ${recipe.ingredients.map(ing => `<li class="text-sm"><span class="font-semibold">${ing.quantity}</span> ${ing.name}</li>`).join('')}
                                                </ul>
                                            </div>
                                            
                                            <!-- Right Column: Instructions and Storage -->
                                            <div class="sm:w-2/3">
                                                <h4 class="text-xl font-bold text-teal-600 mb-2 border-b border-teal-300">INSTRUCTIONS</h4>
                                                <ol class="space-y-3 text-gray-700 instruction-list">
                                                    ${steps.map(step => `<li>${step.trim()}</li>`).join('')}
                                                </ol>

                                                <div class="mt-6 p-3 bg-gray-50 border border-gray-200 rounded-lg">
                                                    <h4 class="text-sm font-bold text-gray-800 uppercase mb-1">Storage:</h4>
                                                    <p class="text-sm text-gray-600 italic">${recipe.storage}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            return htmlContent;
        }
        
        /**
         * Triggers the window.print() function after a brief delay.
         * This improves reliability on some mobile browsers.
         */
        function triggerPrintWithDelay() {
            // Add a small delay (100ms) to ensure the DOM is completely rendered before printing
            setTimeout(() => {
                window.print();
            }, 100); 
        }

        /**
         * Main function to generate the styled HTML document and show the modal.
         */
        function generatePrintableDocument() {
            const selectedCount = Object.values(mealPlan).flatMap(day => Object.values(day)).filter(id => id).length;

            if (selectedCount === 0) {
                showNotification('Please fill at least one meal slot before generating the document.', 'error');
                return;
            }

            const styledHtml = generateStyledHTMLForPrint();
            
            // 1. Display it in the modal
            document.getElementById('outputContentDiv').innerHTML = styledHtml;
            
            // 2. Show the modal
            document.getElementById('printOutputModal').classList.remove('hidden');
            document.getElementById('printOutputModal').classList.add('flex');
        }

        /**
         * Fills the plan with a simple, rotating selection of recipes, applying a primary diet filter if selected.
         */
        function autoFillPlan() {
            const dietFilterValue = document.getElementById('dietFilter').value;
            const dietTag = MAJOR_DIETS[dietFilterValue]; // Get the actual tag string ('Low Carb', 'Vegetarian', etc.)

            // Start with the full recipe list
            let filteredRecipes = RECIPES;

            // Apply the major diet filter if one is selected
            if (dietTag && dietFilterValue !== '') {
                filteredRecipes = RECIPES.filter(r => r.tags.includes(dietTag));
                
                // If the filter removes all recipes, notify the user and stop
                if (filteredRecipes.length === 0) {
                    showNotification(`No recipes available for the selected diet: **${dietFilterValue}**. Please choose a different filter.`, 'error');
                    return;
                }
            }

            let bIndex = 0;
            let lIndex = 0;
            let dIndex = 0;
            let sIndex = 0;

            const bRecipes = filteredRecipes.filter(r => r.category === 'Breakfast');
            const lRecipes = filteredRecipes.filter(r => r.category === 'Lunch');
            const dRecipes = filteredRecipes.filter(r => r.category === 'Dinner');
            const sRecipes = filteredRecipes.filter(r => r.category === 'Snack'); 

            DAYS.forEach(day => {
                if (bRecipes.length > 0) {
                    mealPlan[day]['Breakfast'] = bRecipes[bIndex % bRecipes.length].id;
                    bIndex++;
                } else {
                    mealPlan[day]['Breakfast'] = null;
                }

                if (lRecipes.length > 0) {
                    mealPlan[day]['Lunch'] = lRecipes[lIndex % lRecipes.length].id;
                    lIndex++;
                } else {
                    mealPlan[day]['Lunch'] = null;
                }

                if (dRecipes.length > 0) {
                    mealPlan[day]['Dinner'] = dRecipes[dIndex % dRecipes.length].id;
                    dIndex++;
                } else {
                    mealPlan[day]['Dinner'] = null;
                }

                if (sRecipes.length > 0) {
                    mealPlan[day]['Snack'] = sRecipes[sIndex % sRecipes.length].id;
                    sIndex++;
                } else {
                    mealPlan[day]['Snack'] = null;
                }
            });

            renderMealPlan();
            const message = dietFilterValue === '' ? 'Plan auto-filled with sample recipes!' : `Plan auto-filled using **${dietFilterValue}** filter!`;
            showNotification(message, 'success');
        }

        /**
         * Clears all selections in the meal plan.
         */
        function clearPlan() {
            mealPlan = DAYS.reduce((acc, day) => {
                acc[day] = MEAL_TYPES.reduce((mealAcc, meal) => {
                    mealAcc[meal] = null;
                    return mealAcc;
                }, {});
                return acc;
            }, {});
            renderMealPlan();
            showNotification('Meal plan cleared!', 'success');
        }

        /**
         * Initializes the modal category filter options and the new primary diet filter.
         */
        function initializeFilters() {
            // 1. Initialize Category Filter (for the modal)
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            
            const uniqueCategories = [...new Set(RECIPES.map(r => r.category))].sort();

            uniqueCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });

            // 2. Initialize Major Diet Filter (for the Autofill)
            const dietFilter = document.getElementById('dietFilter');
            dietFilter.innerHTML = ''; // Clear previous options
            
            Object.keys(MAJOR_DIETS).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = MAJOR_DIETS[key];
                dietFilter.appendChild(option);
            });


            // 3. Initialize Tag Buttons (for the modal)
            renderTagButtons();
        }

        // Cover upload setup
        function setupCoverUpload() {
            document.getElementById('coverUpload').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        coverImageDataUrl = event.target.result;
                        document.getElementById('coverPreview').src = coverImageDataUrl;
                        document.getElementById('coverPreviewContainer').classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    coverImageDataUrl = null;
                    document.getElementById('coverPreviewContainer').classList.add('hidden');
                    document.getElementById('coverPreview').src = '';
                }
            });
        }

        // --- Event Listeners and Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderMealPlan();
            initializeFilters();
            setupCoverUpload();

            document.getElementById('autoFillBtn').addEventListener('click', autoFillPlan);
            document.getElementById('clearPlanBtn').addEventListener('click', clearPlan);
            document.getElementById('generatePrintBtn').addEventListener('click', generatePrintableDocument);
        });
    </script>
</body>
</html>